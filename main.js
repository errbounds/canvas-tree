(()=>{"use strict";const t={fixedLength:60,lengthWeight:2,maxDepth:10};class e{constructor(t,e,s,i,h){this.id=h,this.startX=t,this.startY=e,this.endX=s,this.endY=i,this.frame=12,this.currentFrame=0,this.gapX=(this.endX-this.startX)/this.frame,this.gapY=(this.endY-this.startY)/this.frame,this.currentX=this.startX,this.currentY=this.startY}draw(e,s,i){return this.currentFrame>=this.frame||(this.currentX+=this.gapX,this.currentY+=this.gapY,e.lineWidth=t.maxDepth-s,e.strokeStyle=i?"black":"white",e.beginPath(),e.moveTo(this.startX,this.startY),e.lineTo(this.currentX,this.currentY),e.closePath(),e.stroke(),this.currentFrame+=1,!1)}}const s=[];class i{constructor(e,i,h){this.posX=e,this.posY=i,this.id=h,this.branches=new Array(parseInt(t.maxDepth)).fill(0).map((()=>[])),this.drawCurrentDepth=0,s.push(0),this.createBranch(e,i,5*Math.random()-2.5+90,50*Math.random()+70,0)}createBranch(s,i,h,n,a){if(a>=t.maxDepth)return 0;const r=s+n*this.cos(h),d=i-n*this.sin(h);this.branches[a].push(new e(s,i,r,d,this.id));const c=h+(15*Math.random()+10),o=h-(15*Math.random()+10),l=t.fixedLength*Math.random()*t.lengthWeight*((t.maxDepth-a)/t.maxDepth),m=t.fixedLength*Math.random()*t.lengthWeight*((t.maxDepth-a)/t.maxDepth);this.createBranch(r,d,c,l,a+1),this.createBranch(r,d,o,m,a+1)}draw(e,i){return this.drawCurrentDepth===t.maxDepth?(cancelAnimationFrame(s[this.id]),!0):(console.log(this.drawCurrentDepth,t.maxDepth),this.branches[this.drawCurrentDepth].map((t=>t.draw(e,this.drawCurrentDepth,i))).every((t=>t))&&this.drawCurrentDepth++,s[this.id]=requestAnimationFrame(this.draw.bind(this,e,i)),!1)}cos(t){return Math.cos(Math.PI/180*t)}sin(t){return Math.sin(Math.PI/180*t)}}class h{constructor(){this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.pixelRatio=window.devicePixelRatio>1?2:1,window.addEventListener("resize",this.resize.bind(this)),this.canvas.addEventListener("click",this.onclick.bind(this)),this.lightMode=!0,this.setBtn(),this.treeId=0,this.resize()}resize(){this.canvas.width=document.documentElement.clientWidth,this.canvas.height=document.documentElement.clientHeight,this.ctx.scale(this.pixelRatio,this.pixelRatio),s.forEach((t=>cancelAnimationFrame(t))),s.length=0,this.treeId=0,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}onclick(t){this.getData();const{clientX:e}=t;new i(e,this.canvas.height,this.treeId++).draw(this.ctx,this.lightMode)}setBtn(){this.refreshBtn=document.getElementById("refresh"),this.refreshBtn.addEventListener("click",this.resize.bind(this)),this.lightModeBtn=document.getElementById("light-mode"),this.lightModeBtn.addEventListener("click",this.lightBtnHandler.bind(this)),this.darkModeBtn=document.getElementById("dark-mode"),this.darkModeBtn.addEventListener("click",this.darkBtnHandler.bind(this))}lightBtnHandler(){this.lightMode||(this.lightModeBtn.classList.remove("show"),this.darkModeBtn.classList.add("show"),this.canvas.classList.remove("black"),this.refreshBtn.classList.remove("white"),document.getElementById("panel").classList.remove("white"),this.lightMode=!0)}darkBtnHandler(){this.lightMode&&(this.darkModeBtn.classList.remove("show"),this.lightModeBtn.classList.add("show"),this.canvas.classList.add("black"),this.refreshBtn.classList.add("white"),document.getElementById("panel").classList.add("white"),this.lightMode=!1)}getData(){const e=document.getElementById("fixedLength").value,s=document.getElementById("lengthWeight").value,i=document.getElementById("maxDepth").value;t.fixedLength=parseInt(e),t.lengthWeight=parseInt(s),t.maxDepth=parseInt(i)}}window.onload=()=>{new h}})();